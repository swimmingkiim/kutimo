<style>
    a {
        text-decoration: none;
        font-weight: 500;
    }
    a:hover {
        cursor: pointer;
    }
    ::slotted(*) {
        width: 100%;
        height: 100%;
    }
</style>

<a id="go-to" href="/index.html#page=">
    <slot></slot>
</a>

<script name="main" type="module">

    const _utils = import("/js/_util.js");

    const PATH_PREFIX = "/src/pages/";
    const BASE_PREFIX = "/index.html#page=";

    const redirectTo404 = async() => {
        const data = await(await _utils).getFileContentInJSON("/data.json");
        const fileName = (await _utils).getFileName(data["not-found-redirection"]);
        window.location.href = `${BASE_PREFIX}${fileName}`;
    }

    (function() {
        return function main(root, props) {
        const aTag = root.querySelector("#go-to");
        const filePath = `${PATH_PREFIX}${props.to}`;
        let pageURL = `${BASE_PREFIX}${props.to.replace(".html", "")}`;
        if (props.post) {
            pageURL = `${pageURL}#post=${props.post.replace(".html", "")}`;
        }
        aTag.setAttribute("href", pageURL);
        aTag.innerHTML = props._innerHTML;
        aTag.addEventListener("click", async (evt) => {
            evt.preventDefault();
            console.log(`move to : ${pageURL}`);
            try {
                const result = await (await _utils).getFileContentInString(filePath);
                if (result === null) {
                    redirectTo404()
                } else {
                    window.location.href = pageURL;
                }
            } catch(error) {
                console.error(error);
                redirectTo404()
            }
            
        })
    } 
    })()
</script>